<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><HTML>
<HEAD>
<!-- hennerik CVSweb $Revision$ -->
<TITLE>Exemple</TITLE></HEAD>
<BODY BGCOLOR="#eeeeee">
<HR noshade><PRE>
#^SALOMEDS methods : FindOrCreateAttribute, SaveAs, FindComponent, FindAttribute, NewCommand, GetProperties, Open, CommitCommand, NewBuilder^
#^Attribute methods : SetLocked, IsLocked, GetCreationMode, SetCreationDate, IsModified, GetUserName, Value, SetUserName, SetValue, GetCreationDate^

batchmode_geompy.myBuilder._set_UndoLimit(20)

#--------------------------------------------------------------------------
# &nbsp; &nbsp; &nbsp; create AttributeReal &nbsp; &nbsp; &nbsp;
#===============================================
A = batchmode_geompy.myBuilder.FindOrCreateAttribute(batchmode_geompy.father, &quot;AttributeReal&quot;)
if A == None :
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Can't create AttributeReal attribute&quot;
A = A._narrow(SALOMEDS.AttributeReal)
A.SetValue(0.0001)
if A.Value() != 0.0001:
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Error : wrong value of &nbsp;AttributeReal&quot;

# &nbsp; &nbsp; &nbsp;create AttributeStudyProperties
#================================================
A = batchmode_geompy.myStudy.GetProperties()
if A == None :
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Can't create AttributeStudyProperties attribute&quot;
A = A._narrow(SALOMEDS.AttributeStudyProperties)

batchmode_geompy.myBuilder.NewCommand();
print &quot;A.GetUserName()= &quot;, A.GetUserName()
res,mm,hh,dd,mnth,yy=A.GetCreationDate()
print &quot;A.GetCreationDate() = &quot;, mm,hh,dd,mnth,yy
print &quot;A.GetCreationMode() = &quot;, A.GetCreationMode()
print &quot;A.IsModified() = &quot;, A.IsModified()
print &quot;A.IsLocked() = &quot;, A.IsLocked()
if A.IsLocked() == 0 :
 &nbsp; &nbsp; &nbsp; &nbsp;A.SetUserName(&quot;tester&quot;); print 'A.SetUserName(&quot;tester&quot;), A.GetUserName() = ', A.GetUserName()
 &nbsp; &nbsp; &nbsp; &nbsp;A.SetCreationDate(11,11,11,11,2002); print 'A.SetCreationDate(11,11,11,11,2002), A.GetCreationDate() =', A.GetCreationDate()
 &nbsp; &nbsp; &nbsp; &nbsp;print &quot;A.IsModified() = &quot;, A.IsModified()
A.SetLocked(1)

#check the transaction result 
batchmode_geompy.myBuilder.CommitCommand()
if A.GetUserName() != &quot;tester&quot;:
 &nbsp; &nbsp; &nbsp; &nbsp;print 'Control after transaction close : A.GetUserName() = ', A.GetUserName()
 &nbsp; &nbsp; &nbsp; &nbsp;raise RuntimeError, &quot;Field 'UserName' was not modified but had to!&quot;

# try to make some changes wrapped by transaction 
#================================================
batchmode_geompy.myBuilder.NewCommand()
A = batchmode_geompy.myBuilder.FindOrCreateAttribute(batchmode_geompy.father, &quot;AttributeInteger&quot;)

if A == None :
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Can't create AttributeInteger attribute&quot;
A = A._narrow(SALOMEDS.AttributeInteger)
A.SetValue(1000000)

exception_was = None
try : batchmode_geompy.myBuilder.CommitCommand()
except Exception: exception_was = 1

if exception_was is None:
 &nbsp; &nbsp; &nbsp; &nbsp;raise RuntimeError, &quot;Study was locked for changes but CommitCommand did not generate an exception !&quot;

# &nbsp; &nbsp; &nbsp;save / restore study &nbsp; &nbsp; &nbsp;

#================================================
str= os.getenv(&quot;TmpDir&quot;)
if str == None:
 &nbsp; &nbsp; &nbsp; &nbsp;str = &quot;/tmp&quot;
file = str+&quot;/test.hdf&quot;

print &quot; ------- &nbsp;We will save to&quot;, file, &quot;-----------&quot;

batchmode_geompy.myStudyManager.SaveAs(file, batchmode_geompy.myStudy)


#--------------------------------------------------------------------------#
#--------------------------- Open file ------------------------------------# 
#--------------------------------------------------------------------------#

print&quot; -------------- Open &nbsp;&quot; + file + &quot;-------------- &quot; 

openedStudy = batchmode_geompy.myStudyManager.Open(file)
if openedStudy == None:
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Can't open saved study!&quot;

father = openedStudy.FindComponent(&quot;GEOM&quot;)
if father is None:
 &nbsp; &nbsp; &nbsp; &nbsp; raise &nbsp;RuntimeError, &quot;Geom component is not found! &nbsp;Wrong study is opened.&quot; 


#1. &nbsp; &nbsp; find AttributeReal
#================================================

res,A=father.FindAttribute(&quot;AttributeReal&quot;)
if res == 0 or A == None:
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Error: &nbsp;not found AttributeReal&quot;

A = A._narrow(SALOMEDS.AttributeReal)
if A.Value() != 0.0001:
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Error : wrong value of &nbsp;AttributeReal&quot;
 

#2. &nbsp; &nbsp; find AttributeStudyProperties
#=================================================
A=openedStudy.GetProperties()
if res == 0 or A == None:
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Error: &nbsp;not found AttributeStudyProperties&quot;

A = A._narrow(SALOMEDS.AttributeStudyProperties)
if A.IsLocked() == 0 :
 &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Error : AttributeStudyProperties must have Locked flag but have no!&quot;

#get the builder
myBuilder = openedStudy.NewBuilder()

#3. try to make some changes wrapped by transaction 
#==================================================
exception_was = None
try : 
 &nbsp; &nbsp; &nbsp; &nbsp;myBuilder.NewCommand()
 &nbsp; &nbsp; &nbsp; &nbsp;A = myBuilder.FindOrCreateAttribute(father, &quot;AttributeInteger&quot;)

 &nbsp; &nbsp; &nbsp; &nbsp;if A == None :
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;raise &nbsp;RuntimeError, &quot;Can't create AttributeInteger attribute&quot;
 &nbsp; &nbsp; &nbsp; &nbsp;A = A._narrow(SALOMEDS.AttributeInteger)
 &nbsp; &nbsp; &nbsp; &nbsp;A.SetValue(1000000)
 &nbsp; &nbsp; &nbsp; &nbsp;myBuilder.CommitCommand()
except Exception: exception_was = 1

if exception_was is None:
 &nbsp; &nbsp; &nbsp; &nbsp;raise RuntimeError, &quot;Study was locked for changes but CommitCommand did not generate an exception !&quot;


myBuilder.NewCommand()
A=openedStudy.GetProperties()
A = A._narrow(SALOMEDS.AttributeStudyProperties)
A.SetLocked(0)
myBuilder.CommitCommand()

#4.
myBuilder.NewCommand()
A.SetLocked(0);
print &quot;A.GetUserName()= &quot;, A.GetUserName()
print &quot;A.GetCreationDate() = &quot;, A.GetCreationDate()
print &quot;A.GetCreationMode() = &quot;, A.GetCreationMode()
print &quot;A.IsModified() = &quot;, A.IsModified()
myBuilder.CommitCommand()

#5.
myBuilder.NewCommand()
A.SetUserName(&quot;tester1&quot;)
myBuilder.CommitCommand()
print &quot;A.GetUserName()= &quot;, A.GetUserName()

#remove the document file
os.remove(file)
</PRE>